#!/bin/bash
set -e

# Run smoke tests on production environment
# Usage: ./run-smoke-prod.sh
#
# ‚ö†Ô∏è  WARNING: Only run this after staging tests pass
# ‚ö†Ô∏è  This hits the live production environment

echo "üß™ Running smoke tests on PRODUCTION..."
echo "========================================"
echo "Target: https://install.allyourbase.io"
echo ""
read -p "‚ö†Ô∏è  You are about to test PRODUCTION. Continue? (yes/no): " confirm

if [ "$confirm" != "yes" ]; then
  echo "Aborted."
  exit 0
fi

# Load production environment
export $(cat e2e/config/.env.prod | xargs)

# Run smoke tests only (fast validation)
npx playwright test --project=smoke

RESULT=$?

if [ $RESULT -eq 0 ]; then
  echo ""
  echo "‚úÖ Production smoke tests PASSED"
  echo "   Production deployment validated"
  exit 0
else
  echo ""
  echo "‚ùå Production smoke tests FAILED"
  echo "   ‚ö†Ô∏è  CRITICAL: Production may have issues"
  echo "   Consider rollback or immediate investigation"
  exit 1
fi
